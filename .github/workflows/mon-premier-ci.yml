name: Déploiement Robuste vers Hugging Face
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. On récupère ton code (fichiers normaux + gros fichiers)
      - name: Récupérer le code
        uses: actions/checkout@v3
        with:
          lfs: true  # On s'assure de bien prendre les gros fichiers si présents

      # 2. On installe un Python récent
      - name: Installer Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. On installe la librairie Hugging Face (version stable)
      - name: Installer les dépendances
        run: pip install huggingface_hub

      # 4. LE DÉPLOIEMENT (La correction est ICI)
      - name: Upload vers Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          # Au lieu de 'huggingface-cli', on utilise 'python -m huggingface_hub.cli'
          # C'est la méthode qui ne peut PAS échouer avec "command not found"
          
          echo "Connexion à Hugging Face..."
          python -m huggingface_hub.cli login --token $HF_TOKEN
          
          echo "Démarrage de l'upload..."
          # On envoie le contenu du dossier actuel (.) vers ton Space
          python -m huggingface_hub.cli upload andrandraina/emotion-rf-webcam . . --repo-type space --exclude ".git/*" ".github/*"