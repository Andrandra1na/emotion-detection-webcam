name: D√©ploiement Infaillible (Python API)
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. R√©cup√©ration du code
      - name: R√©cup√©rer le code
        uses: actions/checkout@v3
        with:
          lfs: true

      # 2. Installation Python
      - name: Installer Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. Installation de la librairie Hugging Face
      - name: Installer la librairie
        run: pip install huggingface_hub

      # 4. UPLOAD VIA SCRIPT PYTHON (La m√©thode "Expert")
      # On √©crit un petit programme Python qui fait le travail.
      # Impossible d'avoir une erreur "Command not found".
      - name: Upload vers Hugging Face
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          python -c "
          import os
          from huggingface_hub import HfApi

          # On r√©cup√®re le token
          token = os.environ['HF_TOKEN']
          
          # On initialise l'API
          api = HfApi(token=token)
          
          print('Connexion r√©ussie. D√©marrage de l\'upload...')
          
          # On envoie le dossier
          api.upload_folder(
              folder_path='.',
              repo_id='andrandraina/emotion-rf-webcam',
              repo_type='space',
              ignore_patterns=['.git/*', '.github/*']
          )
          print('Upload termin√© avec succ√®s ! üöÄ')
          "